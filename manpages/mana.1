.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "MANA" "1" "31 March 2022" "" ""
.hy
.SH NAME
.PP
\f[B]mana\f[R] \[en] MANA family of commands for checkpointing MPI jobs
.SH SYNOPSIS
.PP
\f[B]mana_launch\f[R] [--help] [--verbose] [DMTCP_OPTIONS] [--ckptdir
\f[I]DIR\f[R]] COMMAND [\f[I]ARGS\&...\f[R]]
.PD 0
.P
.PD
\f[B]mana_coordinator\f[R] [--help] [--verbose]
[\f[I]DMTCP_OPTIONS\f[R]]
.PD 0
.P
.PD
\f[B]mana_start_coordinator\f[R]
.PD 0
.P
.PD
\f[B]mana_status\f[R] [--help] [--verbose] [\f[I]DMTCP_OPTIONS\f[R]]
.PD 0
.P
.PD
\f[B]mana_restart\f[R] [--help] [--verbose] [\f[I]DMTCP_OPTIONS\f[R]]
[--restartdir \f[I]DIR\f[R]]
.SH DESCRIPTION
.PP
\f[B]MANA\f[R] is a package that enables checkpoint-restart for MPI
jobs.
The name MANA stands for \[lq]MPI-Agnostic Network-Agnostic
Checkpointing\[rq].
It is designed to be compatible with most MPI implementations and most
underlying networks.
MANA is built on top of the DMTCP checkpointing package.
.SH COMMAND LINE OPTIONS
.TP
\f[B]\f[VB]--help\f[B]\f[R]
Show additional DMTCP_OPTIONS for a MANA command.
.TP
\f[B]\f[VB]--verbose\f[B]\f[R]
Display the underlying DMTCP command and DMTCP_OPTIONS used, and other
info.
.SH MANA PROGRAM EXECUTION
.PP
Execute a MANA command with \f[V]--help\f[R] for a usage statement.
.PP
Checkpoints may be invoked:
.TP
\f[B]\f[VB]periodically\f[B]\f[R]
via the \f[V]--interval\f[R] or \f[V]-i\f[R] flag (units in seconds)
.TP
\f[B]\f[VB]under program control\f[B]\f[R]
(see \f[V]dmtcp/test/plugin/applic-initiated-ckpt\f[R] directory)
.TP
\f[B]\f[VB]externally\f[B]\f[R]
via \f[V]mana_status --checkpoint\f[R]
.PP
A typical workflow for using MANA after untar\[aq]ing is:
.IP
.nf
\f[C]
cd dmtcp-mana
\&./configure --enable-debug
make -j mana
# Compile against libmana.so: Examples at contrib/mpi-proxy-split/test
salloc -N 2 -q interactive -C haswell -t 01:00:00
bin/mana_coordinator -i10
srun -N 2 bin/mana_launch <TARGET_DIR>/ping_pong.mana.exe
bin/mana_coordinator -i10
srun -N 2 bin/mana_restart
\f[R]
.fi
.PP
MANA supports most features of DMTCP, including:
.IP \[bu] 2
plugins to extend the functionality of DMTCP
.IP \[bu] 2
virtualization of pathname prefixes (plugin/pathvirt)
.IP \[bu] 2
modification of environment variables at restart (plugin/modify-env)
.IP \[bu] 2
distinct checkpoint filenames
(\f[V]dmtcp_launch --enable-unique-checkpoint-filenames\f[R]).
The default is to overwrite the last checkpoint.
.SH ENVIRONMENT VARIABLES AND DEBUGGING
.TP
\f[B]\f[VB]DMTCP_MANA_PAUSE\f[B] or \f[VB]DMTCP_LAUNCH_PAUSE\f[B]\f[R]
DMTCP/MANA will pause during launch to allow \f[V]gdb attach\f[R] (GDB
must be on same node.)
.TP
\f[B]\f[VB]DMTCP_MANA_PAUSE\f[B]\f[R]
DMTCP/MANA will pause very early in restart, inside
\f[V]mtcp/mtcp_restart.c\f[R] shortly before calling
\f[V]splitProcess()\f[R] (intended for developers)
.TP
\f[B]\f[VB]DMTCP_RESTART_PAUSE\f[B]\f[R]
DMTCP/MANA will pause during restart, before resuming execution, to
allow \f[V]gdb attach\f[R] (GDB must be on same node.)
.TP
\f[B]\f[VB]MPI_COLLECTIVE_P2P\f[B]\f[R]
\f[B]For debugging only (high runtime overhead)\f[R]: If this env.
var.
is set, and if re-building any files in
\f[V]mpi-proxy-split/mpi-wrappers\f[R], then MPI collective
communication calls are translated to MPI_Send/Recv at runtime.
(Try \f[V]touch mpi_collective_p2p.c\f[R] if not re-building.)
.PD 0
.P
.PD
.PP
NOTE: You can select specific collective calls for translation to
MPI_Send/Recv by copying MPI wrappers from mpi_collective_p2p.c to
mpi_collective_wrappers.cpp in the mpi-wrappers subdirectory; or block
certain translations by adjusting
\f[V]#ifdef/#ifndef MPI_COLLECTIVE_P2P\f[R] in those files.
.TP
\f[B]\f[VB]MANA_P2P_LOG\f[B]\[dq]\f[R]
For debugging: Set this before mana_launch in order to log the order of
point-to-point calls (MPI_Send and family) for later deterministic
replay.
See details at top of
\f[V]mpi-proxy-split/mpi-wrappers/p2p-deterministic.c\f[R].
.PP
(IMPORTANT: If you checkpoint, continue running for a few minutes after
that, for final updating of the log files.)
.TP
\f[B]\f[VB]MANA_P2P_REPLAY\f[B]\f[R]
For debugging: If a checkpoint was created with \f[V]MANA_P2P_LOG\f[R],
then execute \f[V]mana_p2p_update_logs\f[R] and set this variable before
\f[V]mana_restart\f[R].
(Currently, you need to set this before \f[V]mana_launch\f[R], but this
may be fixed later.)
.PP
To see status of ranks (especially during checkpoint), try:
.IP
.nf
\f[C]
bin/mana_status --list
\f[R]
.fi
.PP
To inspect a checkpoint image from, for example, Rank \f[V]0\f[R], try:
.IP
.nf
\f[C]
util/readdmtcp.sh ckpt_rank0/ckpt_*.dmtcp
\f[R]
.fi
.PP
To debug during restart, try:
.IP
.nf
\f[C]
srun ... env DMTCP\[rs]_RESTART\[rs]_PAUSE=1 mana\[rs]_restart ... APPLICATION
gdb APPLICATION PID  # from a different terminal
\f[R]
.fi
.PP
To see the stack, you then may or may not need to try some of the
following:
.IP
.nf
\f[C]
(gdb) add-symbol-file bin/lh_proxy
(gdb) source util/gdb-dmtcp-utils
(gdb) add-symbol-files-all
(gdb) dmtcp
\f[R]
.fi
.PP
If you are debugging the lower half internals of MANA, you may need:
.IP
.nf
\f[C]
(gdb) file bin/lh_proxy
\f[R]
.fi
.SH BUGS
.PP
NOTE: Compiling VASP-5.4.4 uncovered some bugs in the combination of
\f[V]icpc-19.0.3.199\f[R] and GNU \f[V]gcc\f[R].
.PP
The validation results were:
.IP \[bu] 2
\f[B]icpc+gcc-7.5.0 (built at NERSC)\f[R]: Fails at runtime on VASP
\f[V]during restart\f[R] unless configured with:
.RS 2
.IP
.nf
\f[C]
\&./configure CXXFLAGS=\[aq]-fno-omit-frame-pointer -fno-optimize-sibling-calls\[aq]
\f[R]
.fi
.RE
.IP \[bu] 2
\f[B]icpc+gcc-9.3.0\f[R]: Works correctly
.IP \[bu] 2
\f[B]icpc_gcc-10.1.0 (built at NERSC)\f[R]: Fails to link using
ld-2.35.1
.PP
Report bugs in MANA to: https://github.com/mpickpt/mana
.SH SEE ALSO
.PP
\f[B]dmtcp\f[R](1), \f[B]dmtcp_coordinator\f[R](1),
\f[B]dmtcp_launch\f[R](1), \f[B]dmtcp_restart\f[R](1),
\f[B]dmtcp_command\f[R](1)
.PD 0
.P
.PD
\f[B]MANA home page:\f[R] <https://github.com/mpickpt/mana>
